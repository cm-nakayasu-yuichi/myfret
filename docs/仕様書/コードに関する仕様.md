# コード転調機能の仕様書

## 1. 基本概念

### 1.1 コードの構成要素

コードは以下の 3 つの要素で構成される：

1. キー音（必須）
2. コード修飾（オプション）
3. ベース音（オプション）

例：

-   `C`（キー音のみ）
-   `Cm`（キー音 + コード修飾）
-   `C/G`（キー音 + ベース音）
-   `Cm/G`（キー音 + コード修飾 + ベース音）

### 1.2 音階の表記

12 の音階があり、それぞれ以下のように異名同音で表記される：

| インデックス | シャープ表記 | フラット表記 |
| ------------ | ------------ | ------------ |
| 0            | A            | -            |
| 1            | A#           | B♭           |
| 2            | B            | -            |
| 3            | C            | -            |
| 4            | C#           | D♭           |
| 5            | D            | -            |
| 6            | D#           | E♭           |
| 7            | E            | -            |
| 8            | F            | -            |
| 9            | F#           | G♭           |
| 10           | G            | -            |
| 11           | G#           | A♭           |

## 2. 転調ルール

### 2.1 基本ルール

-   キー音とベース音は同じように半音ずつ移動する
-   コード修飾はそのまま維持される
-   12 半音で 1 周する（循環する）

### 2.2 表記の継承

-   元のコードで使用されている表記（#か ♭ か）を継承する
-   入力されたコードに#/♭ の表記がない場合は#表記を使用する

### 2.3 転調例

```
上方転調の例：
C   → C#  → D
Cm  → C#m → Dm
C/G → C#/G# → D/A

下方転調の例：
E♭    → D     → D♭
E♭m   → Dm    → D♭m
E♭/B♭ → D/A   → D♭/A♭
```

### 2.4 特殊なケース

-   "N.C."などの有効なコード以外の文字列が入力された場合は、
    転調処理を行わず、入力された文字列をそのまま返す
-   有効なコードとは、定義された音階（A, A#, B, ...など）で始まる文字列とする

## 3. 実装要件

### 3.1 主要機能

1. コード文字列の解析（パース）機能
2. 転調処理機能
3. コード文字列の生成機能

### 3.2 エラー処理

-   無効なコード文字列が入力された場合は元の文字列を返す
-   不正なキー音が指定された場合はエラーとして扱う

### 3.3 パフォーマンス要件

-   API による再取得は行わず、フロントエンド側で完結する処理とする
-   複数回の転調にも対応する

## 4. 制約事項

-   コード修飾は 1 つのみ（複数の修飾の組み合わせは考慮しない）
-   特殊なコード記法は対象外
-   ベース音は次期実装としてプレースホルダーを用意する
